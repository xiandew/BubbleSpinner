(()=>{var n={228:t=>{t.exports=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}},858:t=>{t.exports=function(t){if(Array.isArray(t))return t}},646:(t,e,n)=>{var r=n(228);t.exports=function(t){if(Array.isArray(t))return r(t)}},506:t=>{t.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}},575:t=>{t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},100:(r,t,e)=>{var i=e(489),s=e(67);function a(t,e,n){return s()?r.exports=a=Reflect.construct:r.exports=a=function(t,e,n){var r=[null];r.push.apply(r,e);r=new(Function.bind.apply(t,r));return n&&i(r,n.prototype),r},a.apply(null,arguments)}r.exports=a},913:t=>{function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}t.exports=function(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}},525:(r,t,e)=>{var i=e(331);function s(t,e,n){return"undefined"!=typeof Reflect&&Reflect.get?r.exports=s=Reflect.get:r.exports=s=function(t,e,n){t=i(t,e);if(t){e=Object.getOwnPropertyDescriptor(t,e);return e.get?e.get.call(n):e.value}},s(t,e,n||t)}r.exports=s},754:e=>{function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},n(t)}e.exports=n},205:(t,e,n)=>{var r=n(489);t.exports=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&r(t,e)}},67:t=>{t.exports=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}},860:t=>{t.exports=function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}},884:t=>{t.exports=function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var n=[],r=!0,i=!1,s=void 0;try{for(var a,o=t[Symbol.iterator]();!(r=(a=o.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,s=t}finally{try{r||null==o.return||o.return()}finally{if(i)throw s}}return n}}},521:t=>{t.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},206:t=>{t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},585:(t,e,n)=>{var r=n(8),i=n(506);t.exports=function(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?i(t):e}},489:n=>{function r(t,e){return n.exports=r=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},r(t,e)}n.exports=r},38:(t,e,n)=>{var r=n(858),i=n(884),s=n(379),a=n(521);t.exports=function(t,e){return r(t)||i(t,e)||s(t,e)||a()}},331:(t,e,n)=>{var r=n(754);t.exports=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=r(t)););return t}},319:(t,e,n)=>{var r=n(646),i=n(860),s=n(379),a=n(206);t.exports=function(t){return r(t)||i(t)||s(t)||a()}},8:e=>{function n(t){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?e.exports=n=function(t){return typeof t}:e.exports=n=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}e.exports=n},379:(t,e,n)=>{var r=n(228);t.exports=function(t,e){if(t){if("string"==typeof t)return r(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(t,e):void 0}}}},r={};function Ut(t){if(r[t])return r[t].exports;var e=r[t]={exports:{}};return n[t](e,e.exports,Ut),e.exports}Ut.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return Ut.d(e,{a:e}),e},Ut.d=(t,e)=>{for(var n in e)Ut.o(e,n)&&!Ut.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},Ut.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";var t=Ut(575),o=Ut.n(t),e=Ut(913),a=Ut.n(e),t=Ut(38),c=Ut.n(t);const n=[["branding","assets/img/branding.png"],["logo","assets/img/logo-2d.png"],["start-btn","assets/img/start-btn.png"],["rank-btn","assets/img/rank-btn.png"],["pivot","assets/img/pivot.png"],["blue-bubble","assets/img/blue-bubble.png"],["cyan-bubble","assets/img/cyan-bubble.png"],["red-bubble","assets/img/red-bubble.png"],["yellow-bubble","assets/img/yellow-bubble.png"],["pink-bubble","assets/img/pink-bubble.png"],["green-bubble","assets/img/green-bubble.png"],["gray-bubble","assets/img/gray-bubble.png"],["restart-btn","assets/img/restart-btn.png"],["group-rank-btn","assets/img/group-rank-btn.png"],["return-btn","assets/img/return.png"],["share-img","assets/img/share.png"],["DustyPro","assets/bmfonts/DustyPro.png"]];function u(t,e){var n;if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator])return(n=t[Symbol.iterator]()).next.bind(n);if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return i(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0;return function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var r=(a()(s,[{key:"onLoaded",value:function(t){for(var e=this,n=0,r=u(this.assets);!(a=r()).done;){var i=a.value,s=c()(i,2),a=s[0],i=s[1],s=wx.createImage();s.onload=function(){++n>=e.assets.size&&t(e.assets)},s.src=i,this.assets.set(a,s)}}}],[{key:"getInstance",value:function(){return s.instance||(s.instance=new s),s.instance}}]),s);function s(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:n;o()(this,s),this.assets=new Map(t)}var h=function t(){o()(this,t)},l=(a()(f,null,[{key:"getUUID",value:function(){f.assigned=f.assigned||[];var t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)});return f.assigned.includes(t)?this.getUUID():(f.assigned.push(t),t)}}]),f);function f(){o()(this,f)}var d=function t(e,n,r){o()(this,t),this.img=e,this.width=n,this.height=r||e.height/e.width*n},g=(a()(p,[{key:"setX",value:function(t){this.x=t,this.startX=t-this.texture.width/2,this.endX=t+this.texture.width/2}},{key:"setY",value:function(t){this.y=t,this.startY=t-this.texture.height/2,this.endY=t+this.texture.height/2}},{key:"getX",value:function(){return this.x}},{key:"getY",value:function(){return this.y}},{key:"collides",value:function(t){return t.startX<this.endX&&t.startY<this.endY&&t.endX>this.startX&&t.endY>this.startY}},{key:"isTouched",value:function(t){var e=(t.touches[0]||t.changedTouches[0]).clientX,t=(t.touches[0]||t.changedTouches[0]).clientY;return e>=this.startX&&t>=this.startY&&e<=this.endX&&t<=this.endY}},{key:"render",value:function(t){t.drawImage(this.texture.img,this.startX,this.startY,this.texture.width,this.texture.height)}}]),p);function p(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0;o()(this,p),this.id=l.getUUID(),this.texture=new d(t,r,i),this.setX(e),this.setY(n)}var e=Ut(525),v=Ut.n(e),t=Ut(205),y=Ut.n(t),e=Ut(585),b=Ut.n(e),t=Ut(754),S=Ut.n(t),e=Ut(100),x=Ut.n(e),m=(a()(M,[{key:"render",value:function(t){this.target.render(t)}}]),M);function M(t){o()(this,M),this.target=t}function w(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=S()(n);return e=r?(t=S()(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),b()(this,e)}}var R=function(t){y()(n,t);var e=w(n);function n(t){return o()(this,n),(t=e.call(this,t)).startAngle=0,t.stepSize=.01,t}return a()(n,[{key:"render",value:function(t){this.startAngle+=this.stepSize,t.save(),t.translate(this.target.getX(),this.target.getY()),t.rotate(this.startAngle),t.translate(-this.target.getX(),-this.target.getY()),v()(S()(n.prototype),"render",this).call(this,t),t.restore()}}]),n}(m);function k(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=S()(n);return e=r?(t=S()(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),b()(this,e)}}var I=function(t){y()(n,t);var e=k(n);function n(t){return o()(this,n),(t=e.call(this,t)).factor=1,t.step=.02,t}return a()(n,[{key:"render",value:function(t){if(this.target.rotatedOut)return this.outOfSight=!0;this.factor-=this.step;var e=Math.sin(this.factor);t.save(),t.translate(this.target.getX(),this.target.getY()),t.scale(e,e),t.rotate(2*Math.PI*e),t.translate(-this.target.getX(),-this.target.getY()),v()(S()(n.prototype),"render",this).call(this,t),t.restore(),this.factor<=0&&(this.target.rotatedOut=!0)}}]),n}(m);function A(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=S()(n);return e=r?(t=S()(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),b()(this,e)}}var O=function(t){y()(n,t);var e=A(n);function n(t){return o()(this,n),(t=e.call(this,t)).factor=0,t.step=.02,t}return a()(n,[{key:"render",value:function(t){if(this.target.rotatedIn)return v()(S()(n.prototype),"render",this).call(this,t);this.factor+=this.step,this.factor=Math.min(Math.PI/2,this.factor);var e=Math.sin(this.factor);t.save(),t.translate(this.target.getX(),this.target.getY()),t.scale(e,e),t.rotate(2*Math.PI*e),t.translate(-this.target.getX(),-this.target.getY()),v()(S()(n.prototype),"render",this).call(this,t),t.restore(),this.factor>=Math.PI/2&&(this.target.rotatedIn=!0)}}]),n}(m);function D(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=S()(n);return e=r?(t=S()(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),b()(this,e)}}var Y=function(t){y()(n,t);var e=D(n);function n(t){return o()(this,n),(t=e.call(this,t)).factor=1,t.step=.05,t}return a()(n,[{key:"render",value:function(t){if(this.target.fadedOut)return this.outOfSight=!0;this.factor-=this.step,this.factor=Math.max(0,this.factor),t.save();var e=2-this.factor;t.translate(this.target.getX(),this.target.getY()),t.scale(e,e),t.translate(-this.target.getX(),-this.target.getY()),t.globalAlpha=this.factor,v()(S()(n.prototype),"render",this).call(this,t),t.restore(),0==this.factor&&(this.target.fadedOut=!0)}}]),n}(m);function X(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=S()(n);return e=r?(t=S()(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),b()(this,e)}}var H=function(t){y()(n,t);var e=X(n);function n(t){return o()(this,n),(t=e.call(this,t)).target.zoomedIn=!1,t.factor=0,t.step=.05,t}return a()(n,[{key:"render",value:function(t){if(this.target.zoomedIn)return v()(S()(n.prototype),"render",this).call(this,t);this.factor+=this.step,this.factor=Math.min(Math.PI/2,this.factor);var e=Math.sin(this.factor);t.save(),t.translate(this.target.getX(),this.target.getY()),t.scale(e,e),t.translate(-this.target.getX(),-this.target.getY()),v()(S()(n.prototype),"render",this).call(this,t),t.restore(),this.factor>=Math.PI/2&&(this.target.zoomedIn=!0)}}]),n}(m);function T(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=S()(n);return e=r?(t=S()(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),b()(this,e)}}var P=function(t){y()(n,t);var e=T(n);function n(t){return o()(this,n),(t=e.call(this,t)).target.zoomedInUp=!1,t.factor=.5,t.step=.05,t}return a()(n,[{key:"render",value:function(t){if(this.target.zoomedInUp)return v()(S()(n.prototype),"render",this).call(this,t);this.factor+=this.step,this.factor=Math.min(Math.PI/2,this.factor);var e=Math.sin(this.factor);t.save(),t.translate(this.target.getX(),this.target.getY()),t.scale(e,e),t.translate(-this.target.getX(),-this.target.getY()),t.translate(0,(1-e)*(h.screenHeight-this.target.getY())),v()(S()(n.prototype),"render",this).call(this,t),t.restore(),this.factor>=Math.PI/2&&(this.target.zoomedInUp=!0)}}]),n}(m);function B(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=S()(n);return e=r?(t=S()(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),b()(this,e)}}var C=function(t){y()(i,t);var r=B(i);function i(t,e,n){return o()(this,i),r.call(this,t,e,n,i.size)}return i}(g),t=Ut(319),z=Ut.n(t),W=(a()(E,[{key:"toPixel",value:function(){return{x:E.size*(Math.sqrt(3)*this.q+Math.sqrt(3)/2*this.r),y:E.size*(1.5*this.r)}}},{key:"len",value:function(){return(Math.abs(this.q)+Math.abs(this.r)+Math.abs(this.s))/2}},{key:"distance",value:function(t){return E.subtract(this,t).len()}},{key:"round",value:function(){var t=Math.round(this.q),e=Math.round(this.r),n=Math.round(this.s),r=Math.abs(t-this.q),i=Math.abs(e-this.r),s=Math.abs(n-this.s);return i<r&&s<r?t=-e-n:s<i?e=-t-n:n=-t-e,new E(t,e,n)}},{key:"setObj",value:function(t){(t.hex=this).obj=t}},{key:"unsetObj",value:function(){this.obj.hex=null,this.obj=null}}],[{key:"add",value:function(t,e){return new E(t.q+e.q,t.r+e.r,t.s+e.s)}},{key:"subtract",value:function(t,e){return new E(t.q-e.q,t.r-e.r,t.s-e.s)}},{key:"scale",value:function(t,e){return new E(t.q*e,t.r*e,t.s*e)}},{key:"direction",value:function(t){return E.directions[t]}},{key:"neighbor",value:function(t,e){return E.add(t,E.direction(e))}}]),E);function E(t,e,n){if(o()(this,E),this.q=t,this.r=e,this.s=n,0!==Math.round(t+e+n))throw"q + r + s must be 0"}W.directions=[new W(1,0,-1),new W(1,-1,0),new W(0,-1,1),new W(-1,0,1),new W(-1,1,0),new W(0,1,-1)];var N=(a()(j,[{key:"map",value:function(t){return this.data[t.r][t.q-Math.max(0,j.radius-t.r)]}},{key:"centre",value:function(){return this.data[j.radius][j.radius]}},{key:"cubeRing",value:function(t,e){for(var n=[],r=this.map(W.add(t,W.scale(W.direction(4),e))),i=0;i<6;i++)for(var s=0;s<e;s++)r&&(n.push(r),r=this.map(W.neighbor(r,i)));return n}},{key:"cubeSpiral",value:function(t,e){for(var n=[t],r=1;r<=e;r++)n=n.concat(this.cubeRing(t,r));return n}},{key:"getAdjacentHexes",value:function(t){return this.cubeRing(t,1)}}],[{key:"getInstance",value:function(){return j.instance||(j.instance=new j),j.instance}}]),j);function j(){o()(this,j),this.data=new Array(2*j.radius+1);for(var t=0;t<this.data.length;t++)this.data[t]=new Array(2*j.radius+1-Math.abs(j.radius-t));for(var e=-j.radius;e<=j.radius;e++)for(var n=Math.max(-j.radius,-e-j.radius),r=Math.min(j.radius,-e+j.radius),i=n;i<=r;i++){var s=e+j.radius,a=i+j.radius;this.data[a][s-Math.max(0,j.radius-a)]=new W(s,a,-s-a)}}var U=(a()(G,[{key:"createPivot",value:function(){var t=new g(h.assets.get("pivot"),this.screenCentre.x,this.screenCentre.y,C.size,2*Math.sqrt(Math.pow(C.size/2,2)-Math.pow(C.size/4,2)));return this.hexMap.centre().setObj(t),t}},{key:"getSpinnerRadius",value:function(){var t=[2,3,4,5,6];return h.level<t.length?t[h.level]:t[t.length-1]}},{key:"getBubbleAssets",value:function(){return this.bubbleAssets.slice(0,this.getSpinnerRadius()+1)}},{key:"randomBubbleAsset",value:function(){var t=this.getBubbleAssets();return t[Math.floor(Math.random()*t.length)]}},{key:"createBubbles",value:function(){var s=this,t=this.hexMap.cubeSpiral(this.hexMap.centre(),this.getSpinnerRadius());t.shift();var a=this.getBubbleAssets(),o=new Array(t.length);return t.forEach(function(t,e){var n=e%a.length;n||(a=q(a));var r=s.hexToCoordinates(t),i=r.x,r=r.y,r=new C(a[n],i,r);t.setObj(r),o[e]=r}),o}},{key:"hexToCoordinates",value:function(t){var e=t.toPixel(),n=e.x,r=e.y;n+=this.xOffset,r+=this.yOffset;var i=this.spinner.getX(),t=this.spinner.getY(),e=n-i,n=r-t,r=Math.sqrt(Math.pow(e,2)+Math.pow(n,2)),e=Math.atan2(n,e)-this.spinner.angleOfRotation;return{x:i+Math.cos(e)*r,y:t+Math.sin(e)*r}}},{key:"getAdjacentHexes",value:function(t){return this.hexMap.getAdjacentHexes(t)}}]),G);function G(t){o()(this,G),this.spinner=t,this.bubbleAssets=q([h.assets.get("blue-bubble"),h.assets.get("cyan-bubble"),h.assets.get("red-bubble"),h.assets.get("yellow-bubble"),h.assets.get("pink-bubble"),h.assets.get("green-bubble")]),W.size=Math.ceil(.065*h.screenWidth)/2,C.size=W.size*(1/Math.sqrt(3)+1)*2/1.9,N.radius=Math.ceil(Math.max(h.screenWidth,.5*h.screenHeight)/C.size),this.hexMap=N.getInstance(),this.screenCentre={x:.5*h.screenWidth,y:.5*h.screenHeight};t=this.hexMap.centre().toPixel();this.xOffset=this.screenCentre.x-t.x,this.yOffset=this.screenCentre.y-t.y}function q(t){for(var e=t.length-1;0<e;e--){var n=Math.floor(Math.random()*(e+1)),r=[t[n],t[e]];t[e]=r[0],t[n]=r[1]}return t}var F=function t(e,n){var r=this;o()(this,t),this.bitmap=e,this.defaultSize=Math.abs(parseInt(n.info.size)),this.chars={},n.chars.char.forEach(function(t){r.chars[String.fromCharCode(t.id)]=t})},L=(a()(_,[{key:"draw",value:function(n,t){var e,r=this,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,s=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:"left",c=i/this.bitmapFont.defaultSize,t=t.toString().split("");"center"==o&&(e=0,t.forEach(function(t){t=r.bitmapFont.chars[t];e+=c*parseInt(t.xadvance)}),s-=.5*e),"right"==o&&(t=t.reverse()),t.map(function(t){var e=r.bitmapFont.chars[t],t=c*parseInt(e.xadvance);n.drawImage(r.bitmapFont.bitmap,parseInt(e.x),parseInt(e.y),parseInt(e.width),parseInt(e.height),c*parseInt(e.xoffset)+("right"==o?-t:0)+s,c*parseInt(e.yoffset)+a,c*parseInt(e.width),c*parseInt(e.height)),s+=t*("right"==o?-1:1)})}}]),_);function _(t){o()(this,_),this.bitmapFont=t}const K={info:{face:"Dusty Pro",size:"144",bold:"0",italic:"0",charset:"",unicode:"1",stretchH:"100",smooth:"1",aa:"1",padding:"0,0,0,0",spacing:"1,1",outline:"0"},common:{lineHeight:"144",base:"126",scaleW:"512",scaleH:"256",pages:"1",packed:"0",alphaChnl:"0",redChnl:"3",greenChnl:"3",blueChnl:"3"},pages:{page:{id:"0",file:"DustyPro.png"}},chars:{count:"11",char:[{id:"43",x:"429",y:"91",width:"56",height:"54",xoffset:"-1",yoffset:"54",xadvance:"72",page:"0",chnl:"15"},{id:"48",x:"0",y:"0",width:"92",height:"90",xoffset:"-1",yoffset:"36",xadvance:"108",page:"0",chnl:"15"},{id:"49",x:"372",y:"91",width:"56",height:"90",xoffset:"-1",yoffset:"36",xadvance:"72",page:"0",chnl:"15"},{id:"50",x:"93",y:"0",width:"92",height:"90",xoffset:"-1",yoffset:"36",xadvance:"108",page:"0",chnl:"15"},{id:"51",x:"186",y:"0",width:"92",height:"90",xoffset:"-1",yoffset:"36",xadvance:"108",page:"0",chnl:"15"},{id:"52",x:"279",y:"0",width:"92",height:"90",xoffset:"-1",yoffset:"36",xadvance:"108",page:"0",chnl:"15"},{id:"53",x:"372",y:"0",width:"92",height:"90",xoffset:"-1",yoffset:"36",xadvance:"108",page:"0",chnl:"15"},{id:"54",x:"0",y:"91",width:"92",height:"90",xoffset:"-1",yoffset:"36",xadvance:"108",page:"0",chnl:"15"},{id:"55",x:"93",y:"91",width:"92",height:"90",xoffset:"-1",yoffset:"36",xadvance:"108",page:"0",chnl:"15"},{id:"56",x:"186",y:"91",width:"92",height:"90",xoffset:"-1",yoffset:"36",xadvance:"108",page:"0",chnl:"15"},{id:"57",x:"279",y:"91",width:"92",height:"90",xoffset:"-1",yoffset:"36",xadvance:"108",page:"0",chnl:"15"}]}};function V(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=S()(n);return e=r?(t=S()(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),b()(this,e)}}var Z=(a()($,[{key:"update",value:function(){for(var t=this.bubbleScores.length-1;0<=t;t--){var e=this.bubbleScores[t];e.bubble.getY()>h.screenHeight-5*C.size&&(this.bubbleScores.splice(t,1),h.currentScene===h.MainScene.toString()&&(h.score+=e.getScore(),this.rendererManager.setRenderer(e,"FadeOutUp")))}}},{key:"render",value:function(t){this.bitmapText.draw(t,h.score,this.fontSize,this.x,this.y),this.rendererManager.render(t)}},{key:"addBubbleScore",value:function(t){this.bubbleScores.push(new J(t))}}],[{key:"getInstance",value:function(){return $.instance||($.instance=new $),$.instance}}]),$);function $(){o()(this,$),this.id=l.getUUID(),this.bitmapText=new L(new F(h.assets.get("DustyPro"),K)),this.fontSize=.075*h.screenWidth,this.x=.055*h.screenWidth,this.y=.165*h.screenWidth,this.bubbleScores=[],this.rendererManager=new kt}var J=function(t){y()(r,t);var n=V(r);function r(t){var e;return o()(this,r),(e=n.call(this)).bubble=t,e.fontSize=1.2*C.size,e.level=h.level,e}return a()(r,[{key:"getScore",value:function(){function n(t,e){return!t||h.score<e?t:n(t-1,e+(t-1)*r.thresholdUnit)}var t;return this.score=n(this.level+1,(t=this.level+1,z()(Array(t+1).keys()).reduce(function(t,e){return t+e*r.thresholdUnit},0))),this.score}},{key:"render",value:function(t){this.bitmapText.draw(t,"+"+this.score,this.fontSize,this.x,this.y,"center")}}]),r}(Z);J.thresholdUnit=100;var Q=(a()(tt,[{key:"render",value:function(t){this.rendererManager.render(t)}},{key:"resetHealth",value:function(){var e=this;this.sprites&&this.sprites.length&&this.sprites.forEach(function(t){e.rendererManager.remove(t)}),this.currHealth=this.currHealth||Math.ceil(Math.random()*this.maxHealth),this.sprites=new Array(this.currHealth).fill(null).map(function(t,e){return new C(h.assets.get("gray-bubble"),C.size+1.05*C.size*e,C.size)}),this.sprites.forEach(function(t){e.rendererManager.setRenderer(t,"Rotate")})}},{key:"loseHealth",value:function(){this.currHealth--,this.rendererManager.setRenderer(this.sprites.pop(),"FadeOut")}}],[{key:"getInstance",value:function(){return tt.instance||(tt.instance=new tt),tt.instance}}]),tt);function tt(){o()(this,tt),this.id=l.getUUID(),this.currHealth=this.maxHealth=5,this.rendererManager=new kt,this.resetHealth()}function et(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=S()(n);return e=r?(t=S()(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),b()(this,e)}}var nt=(a()(rt,[{key:"reset",value:function(){this.spawnedBubbles=[],this.state=rt.State.UNSPAWNED}},{key:"spawn",value:function(){for(var t=this.minSpawns+Math.round(Math.random()*(this.maxSpawns-this.minSpawns)),e=0,n=Math.random()*Math.PI*2,r=2*Math.PI/t;e<t;e++){var i=Math.cos(n+r*e)*h.screenHeight,s=Math.sin(n+r*e)*h.screenHeight;function a(t){return t.sort(function(t,e){return t-e}),t[Math.floor(t.length/2)]}i=a([-C.size,i,h.screenWidth+C.size]),s=a([-C.size,s,h.screenHeight+C.size]),this.spawnedBubbles.push(new it(this.spinner.controller.randomBubbleAsset(),i,s))}this.state=rt.State.SPAWNED}},{key:"aim",value:function(){var r=this,t=this.spinner.bubbles.slice();t.sort(function(t,e){function n(t){return Math.sqrt(Math.pow(t.getX()-r.spinner.pivot.getX(),2)+Math.pow(t.getY()-r.spinner.pivot.getY(),2))}return n(e)-n(t)});var n=t.slice(0,Math.ceil(Math.random()*this.spawnedBubbles.length/2));this.spawnedBubbles.forEach(function(t){var e=n[Math.floor(Math.random()*n.length)],e=Math.atan2(e.getY()-t.getY(),e.getX()-t.getX());t.speedX=it.speed*Math.cos(e),t.speedY=it.speed*Math.sin(e)}),this.state=rt.State.AIMED,this.spawnedBubbles.forEach(function(t){r.rendererManager.setRenderer(t)})}},{key:"update",value:function(){var e=this;if(!this.health.currHealth&&this.spinner.state==ot.State.STAND){if(this.state==rt.State.UNSPAWNED)return this.spawn();this.state==rt.State.SPAWNED&&this.aim(),this.spawnedBubbles.forEach(function(t){t.inactive||(t.setX(t.getX()+t.speedX),t.setY(t.getY()+t.speedY),e.spinner.collides(t)&&(e.rendererManager.remove(t),t.inactive=!0))}),this.spawnedBubbles.every(function(t){return t.inactive})&&(this.reset(),this.health.resetHealth())}}},{key:"render",value:function(t){this.rendererManager.render(t)}}],[{key:"getInstance",value:function(){return rt.instance||(rt.instance=new rt),rt.instance}}]),rt);function rt(){o()(this,rt),this.id=l.getUUID(),this.spinner=ot.getInstance(),this.health=Q.getInstance(),this.rendererManager=new kt,it.speed=.7*C.size,this.minSpawns=2,this.maxSpawns=8,this.reset()}nt.State=(t=e=function t(){o()(this,t)},e.UNSPAWNED=1,e.SPAWNED=2,e.AIMED=3,t);var it=function(t){y()(i,t);var r=et(i);function i(t,e,n){return o()(this,i),(n=r.call(this,t,e,n)).inactive=!1,n.speedX=n.speedY=0,n}return i}(C);function st(t,e){var n;if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator])return(n=t[Symbol.iterator]()).next.bind(n);if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return at(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return at(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0;return function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function at(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var ot=(a()(ct,[{key:"getX",value:function(){return this.pivot.x}},{key:"getY",value:function(){return this.pivot.y}},{key:"collides",value:function(t){for(var e=st(Array.from(this.bubbles).concat(this.pivot));!(n=e()).done;){var n=n.value;if(n.collides(t))return this.onCollision(n,t),!0}return!1}},{key:"onCollision",value:function(t,n){var s=this,e=this.controller.getAdjacentHexes(t.hex).map(function(t){if(!t||t.obj)return null;var e=t,t=s.controller.hexToCoordinates(t);return{hex:e,coor:t,sortCrit:Math.pow(n.getX()-t.x,2)+Math.pow(n.getY()-t.y,2)}}).filter(function(t){return!!t});if(e.sort(function(t,e){return t.sortCrit-e.sortCrit}),e.length){var r=e[0],i=new C(n.texture.img,r.coor.x,r.coor.y);if(r.hex.setObj(i),this.bubbles.push(i),this.rendererManager.setRenderer(i),!(n instanceof it)){var a=function(e){for(var n=[],r=[],i=[[e]];i.push([]),i[i.length-2].forEach(function(t){s.controller.getAdjacentHexes(t.hex).forEach(function(t){t=t.obj;t&&!r.includes(t)&&(r.push(t),t.texture.img==e.texture.img&&(n.push(t),i[i.length-1].push(t)))})}),i[i.length-1].length;);return n}(i);if(3<=a.length?function(){for(var e=[],n=[],r=[[s.pivot]];r.push([]),r[r.length-2].forEach(function(t){s.controller.getAdjacentHexes(t.hex).forEach(function(t){t=t.obj;!t||n.includes(t)||a.includes(t)||(n.push(t),r[r.length-1].push(t))})}),r[r.length-1].length;);return s.bubbles.forEach(function(t){n.includes(t)||e.push(t)}),e}().forEach(function(t){var e=s.bubbles.indexOf(t);t.hex.unsetObj(),s.bubbles.splice(e,1),s.rendererManager.remove(t),h.MainScene.rendererManager.setRenderer(t,"CollisionAndGravity",n),Z.getInstance().addBubbleScore(t)}):Q.getInstance().loseHealth(),!this.bubbles.length)return h.level++,void this.reload();this.state=ct.State.ROTATING;t=n.speedY/n.speedX,e=i.getY()-t*i.getX(),r=-t,i=-e,r=Math.abs(r*this.pivot.getX()+ +this.pivot.getY()+i)/Math.sqrt(Math.pow(r,2)+Math.pow(1,2))/h.screenWidth,r=n.speed*r;(n.speedX<0&&t*this.pivot.getX()+e>this.pivot.getY()||0<n.speedX&&t*this.pivot.getX()+e<this.pivot.getY())&&(r*=-1),this.angularSpeed=r/this.bubbles.length,this.angularSpeed=Math.sign(this.angularSpeed)*Math.min(Math.abs(this.angularSpeed),this.angularSpeedThreshold),Math.sign(this.angularSpeed)==Math.sign(this.frictionOfRotation)&&(this.frictionOfRotation*=-1)}}}},{key:"reload",value:function(){h.MainScene.rendererManager.setRenderer(this,"RotateOut"),this.state=ct.State.ANIMATING}},{key:"update",value:function(){var i=this;if(this.state==ct.State.ANIMATING&&(this.rotatedIn&&(this.rotatedIn=!1,h.MainScene.rendererManager.setRenderer(this),this.state=ct.State.STAND),this.rotatedOut&&(this.rotatedOut=!1,this.bubbles.forEach(function(t){t.hex.unsetObj(),i.rendererManager.remove(t)}),this.createBubbles(),h.MainScene.rendererManager.setRenderer(this,"RotateIn"))),this.state==ct.State.ROTATING){if(this.angularSpeed+=this.frictionOfRotation,Math.sign(this.angularSpeed)==Math.sign(this.frictionOfRotation))return this.state=ct.State.STAND;this.bubbles.forEach(function(t){var e=t.getY()-i.pivot.getY(),n=t.getX()-i.pivot.getX(),r=Math.sqrt(Math.pow(n,2)+Math.pow(e,2)),n=Math.atan2(e,n)-i.angularSpeed;t.setX(i.pivot.getX()+Math.cos(n)*r),t.setY(i.pivot.getY()+Math.sin(n)*r)}),this.angleOfRotation+=this.angularSpeed,this.bubbles.some(function(t){return t.endX>=h.screenWidth||t.endY>=h.screenHeight||t.startX<=0||t.startY<=0})&&(this.state=ct.State.CRASH,h.openDataContext.postMessage({action:"GameEnded",currentScore:h.score}),h.lastScene=h.currentScene,h.currentScene=h.GameEnded.toString())}}},{key:"render",value:function(t){this.rendererManager.render(t)}},{key:"createPivot",value:function(){this.pivot=this.controller.createPivot(),this.rendererManager.setRenderer(this.pivot)}},{key:"createBubbles",value:function(){var e=this;this.bubbles=this.controller.createBubbles(),this.bubbles.forEach(function(t){e.rendererManager.setRenderer(t)})}}],[{key:"getInstance",value:function(){return ct.instance||(ct.instance=new ct),ct.instance}}]),ct);function ct(){o()(this,ct),this.id=l.getUUID(),this.angularSpeedThreshold=.1,this.angleOfRotation=0,this.frictionOfRotation=0,this.state=ct.State.ANIMATING,this.rendererManager=new kt,this.controller=new U(this),this.createPivot(),this.createBubbles()}function ut(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=S()(n);return e=r?(t=S()(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),b()(this,e)}}ot.State=(t=e=function t(){o()(this,t)},e.ANIMATING=1,e.STAND=2,e.ROTATING=3,e.CRASH=4,t);var ht=(a()(lt,[{key:"createCurrShot",value:function(){return new ft((this.shooter.nextShot||this.createNextShot()).texture.img,this.shootingSpeed)}},{key:"createNextShot",value:function(){var e=this,t=this.spinner.controller.getBubbleAssets(),n=(n=this.spinner.bubbles.map(function(t){return t.texture.img}).concat(t)).filter(function(t){return e.spinner.controller.getBubbleAssets().includes(t)}),r=z()(n.reduce(function(t,e){return t.set(e,(t.get(e)||0)+1)},new Map)).reduce(function(t,e){return e[1]<t[1]?e:t})[0],n=t.concat(new Array(t.length).fill(r)),n=n[Math.floor(Math.random()*n.length)];return n==r&&this.shooter.currShot&&n==this.shooter.currShot.texture.img&&(n=t[Math.floor(Math.random()*t.length)]),new g(n,.5*h.screenWidth,h.screenHeight-.5*C.size,.5*C.size,.5*C.size)}},{key:"permit",value:function(){return Q.getInstance().currHealth&&(this.spinner.state==ot.State.STAND||this.spinner.state==ot.State.ROTATING)}}]),lt);function lt(t){o()(this,lt),this.shooter=t,this.spinner=ot.getInstance(),h.bottomBound=h.screenHeight-C.size,this.shootingSpeed=.75*C.size,this.spinner.frictionOfRotation=1e-4*this.shootingSpeed}var ft=function(t){y()(r,t);var n=ut(r);function r(t,e){return o()(this,r),(t=n.call(this,t,.5*h.screenWidth,h.bottomBound)).speed=e,t}return a()(r,[{key:"collideXBounds",value:function(){return 0<this.speedX&&this.getX()+C.size/2>=h.screenWidth||this.speedX<0&&this.getX()-C.size/2<=0}},{key:"collideYBounds",value:function(){return 0<this.speedY&&this.getY()>=h.bottomBound||this.speedY<0&&this.getY()-C.size/2<=0}},{key:"update",value:function(){this.setX(this.getX()+this.speedX),this.setY(this.getY()+this.speedY),this.setY(Math.min(this.getY(),h.bottomBound))}}]),r}(C),dt=(a()(gt,[{key:"onTouchStart",value:function(t){this.tsHandler=t,wx.onTouchStart(this.tshandler)}},{key:"onTouchMove",value:function(t){this.tmHandler=t,wx.onTouchMove(this.tmHandler)}},{key:"onTouchEnd",value:function(t){this.teHandler=t,wx.onTouchEnd(this.teHandler)}},{key:"destroy",value:function(){this.tsHandler&&wx.offTouchStart(this.tsHandler),this.tmHandler&&wx.offTouchMove(this.tmHandler),this.teHandler&&wx.offTouchEnd(this.teHandler)}}]),gt);function gt(){o()(this,gt)}var pt=(a()(vt,[{key:"reload",value:function(){return this.currShot&&this.rendererManager.remove(this.currShot),this.nextShot&&this.rendererManager.remove(this.nextShot),this.currShot=this.controller.createCurrShot(),this.nextShot=this.controller.createNextShot(),this.rendererManager.setRenderer(this.nextShot,"ZoomIn"),this.rendererManager.setRenderer(this.currShot,"ZoomInUp"),this.curbounces=0,this.state=vt.State.LOADING}},{key:"update",value:function(){return this.state==vt.State.LOADING&&this.currShot.zoomedInUp||this.state==vt.State.RESTORING&&this.currShot.landed?this.state=vt.State.LOADED:this.state==vt.State.SHOOTING?this.controller.spinner.collides(this.currShot)?this.reload():((this.currShot.collideXBounds()?(this.currShot.speedX*=-1,1):this.currShot.collideYBounds()&&(this.currShot.speedY*=-1,1))&&this.curbounces++,this.curbounces>=this.maxBounces&&this.currShot.speedY<0?(this.rendererManager.setRenderer(this.currShot,"GravityAndBounce"),this.curbounces=0,this.state=vt.State.RESTORING):void this.currShot.update()):void 0}},{key:"render",value:function(t){this.rendererManager.render(t)}}],[{key:"getInstance",value:function(){return vt.instance||(vt.instance=new vt),vt.instance}}]),vt);function vt(){var e=this;o()(this,vt),this.id=l.getUUID(),this.controller=new ht(this),this.maxBounces=8,this.touchHandler=new dt,wx.onTouchStart(function(t){h.currentScene==h.MainScene.toString()&&e.state==vt.State.LOADED&&e.controller.permit()&&(e.state=vt.State.AIMING,e.touchX=t.touches[0].clientX,e.touchY=t.touches[0].clientY)}),this.touchHandler.onTouchMove(function(t){e.state==vt.State.AIMING&&(e.touchX=t.touches[0].clientX,e.touchY=t.touches[0].clientY)}),this.touchHandler.onTouchEnd(function(){var t;e.state==vt.State.AIMING&&(e.state=vt.State.SHOOTING,t=Math.atan2(e.touchY-e.currShot.getY(),e.touchX-e.currShot.getX()),e.currShot.speedX=e.currShot.speed*Math.cos(t),e.currShot.speedY=e.currShot.speed*Math.sin(t))}),this.rendererManager=new kt,this.rendererManager.setRenderer(this,"Trace"),this.reload()}function yt(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=S()(n);return e=r?(t=S()(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),b()(this,e)}}pt.State=(t=e=function t(){o()(this,t)},e.LOADING=1,e.LOADED=2,e.AIMING=3,e.SHOOTING=4,e.RESTORING=5,t);var bt=function(t){y()(n,t);var e=yt(n);function n(t){return o()(this,n),(t=e.call(this,t)).canvas=wx.createCanvas(),t.canvas.width=canvas.width,t.canvas.height=canvas.height,t.ctx=t.canvas.getContext("2d"),t.ctx.scale(h.pixelRatio,h.pixelRatio),t.ctx.lineWidth=C.size,t.ctx.lineCap="round",t}return a()(n,[{key:"render",value:function(t){this.target.state==pt.State.AIMING&&(this.ctx.beginPath(),this.ctx.moveTo(.5*h.screenWidth,h.bottomBound),this.ctx.lineTo(this.target.touchX,this.target.touchY),this.ctx.stroke(),this.ctx.closePath(),this.ctx.globalCompositeOperation="source-in",this.ctx.fillStyle="rgba(0, 128, 0, 0.2)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.globalCompositeOperation="source-over",t.drawImage(this.canvas,0,0,h.screenWidth,h.screenHeight),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height))}}]),n}(m);function St(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=S()(n);return e=r?(t=S()(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),b()(this,e)}}var xt=function(t){y()(n,t);var e=St(n);function n(t){return o()(this,n),(t=e.call(this,t)).target.speedX=2.5*(0<t.speedX?1:-1),t.target.landed=!1,t}return a()(n,[{key:"render",value:function(t){if(this.target.landed)return v()(S()(n.prototype),"render",this).call(this,t);this.target.collideXBounds()&&(this.target.speedX*=-1),this.target.collideYBounds()&&(this.target.speedY*=-1,this.target.speedY*=.7),this.target.speedY+=1,this.target.speedX*=.998,this.target.update(),Math.abs(this.target.getX()-h.screenWidth/2)<1&&Math.abs(this.target.getY()-h.bottomBound)<.001&&(this.target.setX(h.screenWidth/2),this.target.setY(h.bottomBound),this.target.landed=!0),v()(S()(n.prototype),"render",this).call(this,t)}}]),n}(m);function mt(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=S()(n);return e=r?(t=S()(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),b()(this,e)}}var Mt=function(t){y()(s,t);var i=mt(s);function s(t,e){var n;o()(this,s),n=i.call(this,t);var r=Math.atan2(e.speedY,e.speedX),t=Math.atan2(n.target.getY()-e.getY(),n.target.getX()-e.getX()),r=r-t,r=e.speed*Math.cos(r)/2;return n.target.speedX=r*Math.cos(t),n.target.speedY=r*Math.sin(t),n}return a()(s,[{key:"render",value:function(t){if(this.target.getX()<=-C.size||this.target.getX()>=h.screenWidth+C.size||this.target.getY()>=h.screenHeight+C.size)return this.outOfSight=!0;this.target.speedX*=.998,this.target.speedY+=.98,this.target.setY(this.target.getY()+this.target.speedY),this.target.setX(this.target.getX()+this.target.speedX),v()(S()(s.prototype),"render",this).call(this,t)}}]),s}(m);function wt(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=S()(n);return e=r?(t=S()(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),b()(this,e)}}var Rt=function(t){y()(r,t);var n=wt(r);function r(t){var e;return o()(this,r),(e=n.call(this,t)).target.x=((t=[C.size,e.target.bubble.getX(),h.screenWidth-C.size]).sort(function(t,e){return t-e}),t[1]),e.target.y=e.y=e.target.bubble.getY(),e.factor=0,e.step=.035,e}return a()(r,[{key:"render",value:function(t){if(this.factor>=Math.PI/2)return this.outOfSight=!0;t.save(),t.globalAlpha=1-Math.sin(this.factor),this.target.y=this.y-30*Math.sin(this.factor),this.target.render(t),t.restore(),this.factor+=this.step}}]),r}(m),kt=(a()(It,[{key:"setRenderer",value:function(t){for(var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length,r=new Array(2<n?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];e="Rotate"===e?new R(t):"RotateOut"===e?new I(t):"RotateIn"===e?new O(t):"FadeOut"===e?new Y(t):"ZoomIn"===e?new H(t):"ZoomInUp"===e?new P(t):"Trace"===e?new bt(t):"GravityAndBounce"===e?new xt(t):"CollisionAndGravity"===e?x()(Mt,[t].concat(r)):new("FadeOutUp"===e?Rt:m)(t);this.renderers[t.id]=e,this.targets.includes(t.id)||this.targets.unshift(t.id)}},{key:"remove",value:function(e){this.targets.splice(this.targets.findIndex(function(t){return t===e.id}),1),this.renderers[e.id]=null}},{key:"render",value:function(t){for(var e=this.targets.length-1;0<=e;e--){var n=this.renderers[this.targets[e]];n.outOfSight?this.remove(n.target):n.render(t)}}}]),It);function It(){o()(this,It),this.targets=[],this.renderers={}}a()(At,[{key:"update",value:function(){}},{key:"render",value:function(){this.ctx.clearRect(0,0,h.screenWidth,h.screenHeight),this.ctx.fillRect(0,0,h.screenWidth,h.screenHeight)}}]),t=At;function At(){o()(this,At),this.ctx=h.ctx}function Ot(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=S()(n);return e=r?(t=S()(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),b()(this,e)}}var Dt=function(t){y()(i,t);var r=Ot(i);function i(){var e;o()(this,i),e=r.call(this),h.currentScene=e.toString(),e.branding=new g(h.assets.get("branding"),.5*h.screenWidth,.2*h.screenHeight,.6*h.screenWidth),e.logo=new g(h.assets.get("logo"),.5*h.screenWidth,.5*h.screenHeight,.175*h.screenWidth);var t=wx.createCanvas(),n=t.getContext("2d");return n.fillStyle="rgba(117, 119, 126, 0.8)",n.fillRect(0,0,t.width,t.height),e.mask=new g(t,.5*h.screenWidth,.5*h.screenHeight,h.screenWidth,h.screenHeight),e.startBtn=new g(h.assets.get("start-btn"),.5*h.screenWidth,.8*h.screenHeight,.45*h.screenWidth),e.rankBtn=new g(h.assets.get("rank-btn"),.5*h.screenWidth,.92*h.screenHeight,.08*h.screenWidth),e.touchHandler=new dt,e.touchHandler.onTouchEnd(function(t){h.currentScene===e.toString()&&(e.startBtn.isTouched(t)&&(e.touchHandler.destroy(),e.rendererManager.remove(e.branding),e.rendererManager.remove(e.startBtn),e.rendererManager.remove(e.rankBtn),e.rendererManager.setRenderer(e.logo,"RotateOut"),e.rendererManager.setRenderer(e.mask,"FadeOut"),h.lastScene=e.toString(),h.currentScene=h.MainScene.toString()),e.rankBtn.isTouched(t)&&(h.openDataContext.postMessage({action:"RankScene"}),h.lastScene=e.toString(),h.currentScene=h.RankScene.toString()))}),e.rendererManager=new kt,e.rendererManager.setRenderer(e.logo,"Rotate"),e.rendererManager.setRenderer(e.mask),e.rendererManager.setRenderer(e.branding),e.rendererManager.setRenderer(e.startBtn),e.rendererManager.setRenderer(e.rankBtn),e}return a()(i,[{key:"render",value:function(){if(v()(S()(i.prototype),"render",this).call(this),h.currentScene===h.RankScene.toString())return h.RankScene.render();this.rendererManager.render(this.ctx),this.mask.fadedOut&&this.logo.rotatedOut&&(cancelAnimationFrame(this.frameID),h.MainScene.run())}},{key:"run",value:function(){this.frameID=requestAnimationFrame(this.run.bind(this)),this.update(),this.render()}},{key:"toString",value:function(){return"MainMenu"}}],[{key:"getInstance",value:function(){return i.instance||(i.instance=new i),i.instance}}]),i}(t);function Yt(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=S()(n);return e=r?(t=S()(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),b()(this,e)}}var Xt=function(t){y()(n,t);var e=Yt(n);function n(){var t;return o()(this,n),(t=e.call(this)).spinner=ot.getInstance(),t.shooter=pt.getInstance(),t.health=Q.getInstance(),t.score=Z.getInstance(),t.npc=nt.getInstance(),t.rendererManager=new kt,t.rendererManager.setRenderer(t.spinner,"RotateIn"),t.rendererManager.setRenderer(t.shooter),t.rendererManager.setRenderer(t.health),t.rendererManager.setRenderer(t.score),t.rendererManager.setRenderer(t.npc),t}return a()(n,[{key:"update",value:function(){this.shooter.update(),this.spinner.update(),this.score.update(),this.npc.update()}},{key:"render",value:function(){v()(S()(n.prototype),"render",this).call(this),this.rendererManager.render(this.ctx),h.currentScene==h.GameEnded.toString()&&(h.AdController.showInterstitialAdOnce(),h.GameEnded.render()),h.currentScene==h.RankScene.toString()&&h.RankScene.render()}},{key:"restart",value:function(){h.score=0,h.level=0,this.health.resetHealth(),this.spinner.reload(),this.shooter.reload()}},{key:"run",value:function(){this.frameID=requestAnimationFrame(this.run.bind(this)),this.update(),this.render()}},{key:"toString",value:function(){return"MainScene"}}],[{key:"getInstance",value:function(){return n.instance||(n.instance=new n),n.instance}}]),n}(t);function Ht(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=S()(n);return e=r?(t=S()(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),b()(this,e)}}var Tt=function(t){y()(i,t);var r=Ht(i);function i(){var e;o()(this,i),e=r.call(this);var t=wx.createCanvas(),n=t.getContext("2d");return n.fillStyle="rgba(30, 30, 30, 0.9)",n.fillRect(0,0,t.width,t.height),e.mask=new g(t,.5*h.screenWidth,.5*h.screenHeight,h.screenWidth,h.screenHeight),e.returnBtn=new g(h.assets.get("return-btn"),.12*h.screenWidth,.9*h.screenHeight,.06*h.screenWidth),e.groupRankBtn=new g(h.assets.get("group-rank-btn"),.75*h.screenWidth,.9*h.screenHeight,.3*h.screenWidth),e.touchHandler=new dt,e.touchHandler.onTouchEnd(function(t){h.currentScene===e.toString()&&(e.groupRankBtn.isTouched(t)&&wx.shareAppMessage({title:"查看群排行",imageUrl:h.assets.get("share-img").src}),e.returnBtn.isTouched(t)&&(h.currentScene=h.lastScene,h.lastScene=e.toString(),h.openDataContext.postMessage({action:h.currentScene,lastScene:h.lastScene})))}),e.rendererManager=new kt,e.rendererManager.setRenderer(e.mask),e.rendererManager.setRenderer(e.returnBtn),e.rendererManager.setRenderer(e.groupRankBtn),e.rendererManager.setRenderer(h.sharedCanvas),e}return a()(i,[{key:"render",value:function(){this.rendererManager.render(this.ctx)}},{key:"toString",value:function(){return"RankScene"}}],[{key:"getInstance",value:function(){return i.instance||(i.instance=new i),i.instance}}]),i}(t);function Pt(n){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=S()(n);return e=r?(t=S()(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),b()(this,e)}}var Bt=function(t){y()(i,t);var r=Pt(i);function i(){var e;o()(this,i),e=r.call(this);var t=wx.createCanvas(),n=t.getContext("2d");n.fillStyle="rgba(30, 30, 30, 0.9)",n.fillRect(0,0,t.width,t.height),e.mask=new g(t,.5*h.screenWidth,.5*h.screenHeight,h.screenWidth,h.screenHeight),e.restartBtn=new g(h.assets.get("restart-btn"),.5*h.screenWidth,.75*h.screenHeight,.45*h.screenWidth);n=wx.createCanvas(),t=n.getContext("2d");return t.fillStyle="rgba(0, 0, 0, 0.5)",t.fillRect(0,0,n.width,n.height),e.leaderboardThumbnailBackground=new g(n,.5*h.screenWidth,.43*h.screenHeight,.85*h.screenWidth,.26*h.screenHeight),e.touchHandler=new dt,e.touchHandler.onTouchEnd(function(t){h.currentScene===e.toString()&&(e.leaderboardThumbnailBackground.isTouched(t)&&(h.openDataContext.postMessage({action:"RankScene"}),h.lastScene=h.currentScene,h.currentScene=h.RankScene.toString()),e.restartBtn.isTouched(t)&&(h.AdController.resetInterstitialAdShownOnce(),h.openDataContext.postMessage({action:"Restart"}),h.currentScene=h.MainScene.toString(),h.lastScene=e.toString(),h.MainScene.restart()))}),e.rendererManager=new kt,e.rendererManager.setRenderer(e.mask),e.rendererManager.setRenderer(e.restartBtn),e.rendererManager.setRenderer(e.leaderboardThumbnailBackground),e.rendererManager.setRenderer(h.sharedCanvas),e}return a()(i,[{key:"render",value:function(){this.rendererManager.render(this.ctx)}},{key:"toString",value:function(){return"GameEnded"}}],[{key:"getInstance",value:function(){return i.instance||(i.instance=new i),i.instance}}]),i}(t),Ct=(a()(zt,[{key:"checkSDKVersion",value:function(t){var e=(e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.SDKVersion).split(".");t=t.split(".");for(var n=Math.max(e.length,t.length);e.length<n;)e.push("0");for(;t.length<n;)t.push("0");for(var r=0;r<n;r++){var i=parseInt(e[r]),s=parseInt(t[r]);if(s<i)return 1;if(i<s)return-1}return 0}}],[{key:"getInstance",value:function(){return zt.instance||(zt.instance=new zt),zt.instance}}]),zt);function zt(){o()(this,zt),this.SDKVersion=wx.getSystemInfoSync().SDKVersion}var Wt="adunit-05504e088717e5b8",Et=(a()(Nt,[{key:"showInterstitialAdOnce",value:function(){!this.interstitialAdShownOnce&&this.interstitialAd&&(this.interstitialAd.show().catch(function(t){console.error(t)}),this.interstitialAdShownOnce=!0)}},{key:"resetInterstitialAdShownOnce",value:function(){this.interstitialAdShownOnce=!1}}],[{key:"getInstance",value:function(){return Nt.instance||(Nt.instance=new Nt),Nt.instance}}]),Nt);function Nt(){o()(this,Nt),this.interstitialAd=null,this.interstitialAdShownOnce=!1,0<=Ct.getInstance().checkSDKVersion("2.6.0")&&wx.createInterstitialAd&&(this.interstitialAd=wx.createInterstitialAd({adUnitId:Wt}))}a()(jt,[{key:"onAssetsLoaded",value:function(t){h.assets=t;var e=wx.getSystemInfoSync(),n=e.screenWidth,r=e.screenHeight,t=e.pixelRatio;canvas.width=n*t,canvas.height=r*t,h.screenWidth=n,h.screenHeight=r,h.pixelRatio=t,h.ctx=canvas.getContext("2d"),h.ctx.fillStyle="#ffffff",h.ctx.scale(t,t);e=wx.getOpenDataContext(),t=e.canvas;t.width=canvas.width,t.height=canvas.height,h.sharedCanvas=new g(t,.5*n,.5*r,n,r),h.openDataContext=e,h.openDataContext.postMessage({action:"LoadAssets"}),h.fps=60,wx.setPreferredFramesPerSecond(h.fps),h.score=0,h.level=0,h.MainMenu=Dt.getInstance(),h.MainScene=Xt.getInstance(),h.RankScene=Tt.getInstance(),h.GameEnded=Bt.getInstance(),h.AdController=Et.getInstance(),h.MainMenu.run()}}]),t=jt;function jt(){var e=this;o()(this,jt),r.getInstance().onLoaded(function(t){return e.onAssetsLoaded(t)})}wx.showShareMenu({withShareTicket:!0}),wx.onShareAppMessage(function(){return{title:"即刻畅玩，战豆到底！",imageUrl:h.assets.get("share-img").src}}),wx.onShow(function(t){t=t.shareTicket;t&&(h.openDataContext.postMessage({action:"RankScene",shareTicket:t}),h.currentScene!=h.RankScene.toString()&&(h.lastScene=h.currentScene),h.currentScene=h.RankScene.toString())}),new t})()})();